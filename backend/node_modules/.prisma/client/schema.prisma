generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Player {
  id              Int               @id @default(autoincrement())
  pfr_id          String?           @unique // optional Pro-Football-Reference ID
  name            String // abbreviated name like "D.Jones"
  team            String?
  position        String?
  GameStats       GameStat[]
  PlayerStats     PlayerStats[]
  AdvancedMetrics AdvancedMetrics[]
}

model GameStat {
  id                     Int       @id @default(autoincrement())
  playerId               Int
  season                 Int
  week                   Int?
  games                  Int? // Number of games played (season-level only)
  gameDate               DateTime?
  passingYds             Int?
  passing_tds            Int?
  passing_interceptions  Int?
  passing_attempts       Int?
  passing_completions    Int?
  passing_sacks          Int?
  rushingYds             Int?
  rushing_attempts       Int?
  rushing_tds            Int?
  receivingYds           Int?
  receiving_tds          Int?
  targets                Int?
  receptions             Int?
  // EPA metrics (week-by-week and yearly)
  passing_epa            Float?
  passing_epa_per_play   Float?
  passing_success_rate   Float?
  rushing_epa            Float?
  rushing_epa_per_play   Float?
  rushing_success_rate   Float?
  receiving_epa          Float?
  receiving_epa_per_play Float?
  receiving_success_rate Float?
  epa                    Float?
  success_rate           Float?
  cpoe                   Float?
  // deprecated: attempts (was ambiguous), use passing_attempts or rushing_attempts
  Player                 Player    @relation(fields: [playerId], references: [id])

  @@index([playerId])
  @@index([season])
}

model Play {
  id                   Int       @id @default(autoincrement())
  game_id              String
  play_id              String
  season               Int
  week                 Int?
  game_date            DateTime?
  play_type            String?
  // Passer info
  passer_player_id     String?
  passer_player_name   String?
  passing_yards        Int?
  pass_attempt         Boolean?
  complete_pass        Boolean?
  sack                 Boolean?
  interception         Boolean?
  cpoe                 Float? // Completion Percentage Over Expected
  // Rusher info
  rusher_player_id     String?
  rusher_player_name   String?
  rushing_yards        Int?
  rush_attempt         Boolean?
  // Receiver info
  receiver_player_id   String?
  receiver_player_name String?
  receiving_yards      Int?
  yards_after_catch    Int?
  air_yards            Int?
  reception            Boolean?
  target               Boolean?
  // Scoring
  pass_touchdown       Boolean?
  rush_touchdown       Boolean?
  receiving_touchdown  Boolean?
  // Game context
  posteam              String?
  defteam              String?
  down                 Int?
  ydstogo              Int?
  yardline_100         Int?
  qtr                  Int?

  @@index([passer_player_id])
  @@index([rusher_player_id])
  @@index([receiver_player_id])
  @@index([season])
  @@index([game_id])
}

model PlayerStats {
  id                                Int    @id @default(autoincrement())
  playerId                          Int
  season                            Int
  median_yards_per_pass_attempt     Float?
  average_yards_per_pass_attempt    Float?
  median_yards_per_rushing_attempt  Float?
  average_yards_per_rushing_attempt Float?
  median_yards_per_reception        Float?
  average_yards_per_reception       Float?

  Player Player @relation(fields: [playerId], references: [id])

  @@unique([playerId, season])
  @@index([playerId])
}

model AdvancedMetrics {
  id                     Int    @id @default(autoincrement())
  playerId               Int
  season                 Int
  epa                    Float? // Total EPA for the season
  epa_per_play           Float? // EPA per play
  cpoe                   Float? // Completion Percentage Over Expected
  success_rate           Float? // Percentage of plays with EPA > 0
  passing_epa            Float? // EPA on dropback/passing plays
  passing_epa_per_play   Float? // EPA per passing play
  passing_success_rate   Float? // % of passing plays with EPA > 0
  rushing_epa            Float? // EPA on rushing plays
  rushing_epa_per_play   Float? // EPA per rushing play
  rushing_success_rate   Float? // % of rushing plays with EPA > 0
  receiving_epa          Float? // EPA on receiving plays
  receiving_epa_per_play Float? // EPA per receiving play
  receiving_success_rate Float? // % of receiving plays with EPA > 0

  Player Player @relation(fields: [playerId], references: [id])

  @@unique([playerId, season])
  @@index([playerId])
}
